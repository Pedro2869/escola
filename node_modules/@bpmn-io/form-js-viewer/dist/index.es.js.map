{"version":3,"file":"index.es.js","sources":["../../../node_modules/diagram-js/lib/core/EventBus.js","../src/core/Validator.js","../src/core/FormFieldRegistry.js","../src/util/injector.js","../src/util/form.js","../src/util/index.js","../src/import/Importer.js","../src/import/index.js","../src/render/components/Sanitizer.js","../src/render/components/Util.js","../src/render/components/form-fields/Button.js","../src/render/context/FormRenderContext.js","../src/render/context/FormContext.js","../src/render/components/Description.js","../src/render/components/Errors.js","../src/render/components/Label.js","../src/render/components/form-fields/Checkbox.js","../src/render/hooks/useService.js","../src/render/hooks/useValuesAsync.js","../src/render/components/form-fields/Checklist.js","../src/render/components/FormField.js","../src/render/components/form-fields/Default.js","../src/render/components/PoweredBy.js","../src/render/components/FormComponent.js","../src/render/components/form-fields/Number.js","../src/render/components/form-fields/Radio.js","../src/render/components/form-fields/Select.js","../src/render/components/form-fields/icons/Close.svg","../src/render/hooks/useKeyDownAction.js","../src/render/components/form-fields/parts/DropdownList.js","../src/render/components/form-fields/Taglist.js","../src/render/components/form-fields/Text.js","../src/render/components/form-fields/Textfield.js","../src/render/components/index.js","../src/render/FormFields.js","../src/render/Renderer.js","../src/render/index.js","../src/core/index.js","../src/Form.js","../src/index.js"],"sourcesContent":["import {\n  isFunction,\n  isArray,\n  isNumber,\n  bind,\n  assign\n} from 'min-dash';\n\nvar FN_REF = '__fn';\n\nvar DEFAULT_PRIORITY = 1000;\n\nvar slice = Array.prototype.slice;\n\n/**\n * A general purpose event bus.\n *\n * This component is used to communicate across a diagram instance.\n * Other parts of a diagram can use it to listen to and broadcast events.\n *\n *\n * ## Registering for Events\n *\n * The event bus provides the {@link EventBus#on} and {@link EventBus#once}\n * methods to register for events. {@link EventBus#off} can be used to\n * remove event registrations. Listeners receive an instance of {@link Event}\n * as the first argument. It allows them to hook into the event execution.\n *\n * ```javascript\n *\n * // listen for event\n * eventBus.on('foo', function(event) {\n *\n *   // access event type\n *   event.type; // 'foo'\n *\n *   // stop propagation to other listeners\n *   event.stopPropagation();\n *\n *   // prevent event default\n *   event.preventDefault();\n * });\n *\n * // listen for event with custom payload\n * eventBus.on('bar', function(event, payload) {\n *   console.log(payload);\n * });\n *\n * // listen for event returning value\n * eventBus.on('foobar', function(event) {\n *\n *   // stop event propagation + prevent default\n *   return false;\n *\n *   // stop event propagation + return custom result\n *   return {\n *     complex: 'listening result'\n *   };\n * });\n *\n *\n * // listen with custom priority (default=1000, higher is better)\n * eventBus.on('priorityfoo', 1500, function(event) {\n *   console.log('invoked first!');\n * });\n *\n *\n * // listen for event and pass the context (`this`)\n * eventBus.on('foobar', function(event) {\n *   this.foo();\n * }, this);\n * ```\n *\n *\n * ## Emitting Events\n *\n * Events can be emitted via the event bus using {@link EventBus#fire}.\n *\n * ```javascript\n *\n * // false indicates that the default action\n * // was prevented by listeners\n * if (eventBus.fire('foo') === false) {\n *   console.log('default has been prevented!');\n * };\n *\n *\n * // custom args + return value listener\n * eventBus.on('sum', function(event, a, b) {\n *   return a + b;\n * });\n *\n * // you can pass custom arguments + retrieve result values.\n * var sum = eventBus.fire('sum', 1, 2);\n * console.log(sum); // 3\n * ```\n */\nexport default function EventBus() {\n  this._listeners = {};\n\n  // cleanup on destroy on lowest priority to allow\n  // message passing until the bitter end\n  this.on('diagram.destroy', 1, this._destroy, this);\n}\n\n\n/**\n * Register an event listener for events with the given name.\n *\n * The callback will be invoked with `event, ...additionalArguments`\n * that have been passed to {@link EventBus#fire}.\n *\n * Returning false from a listener will prevent the events default action\n * (if any is specified). To stop an event from being processed further in\n * other listeners execute {@link Event#stopPropagation}.\n *\n * Returning anything but `undefined` from a listener will stop the listener propagation.\n *\n * @param {string|Array<string>} events\n * @param {number} [priority=1000] the priority in which this listener is called, larger is higher\n * @param {Function} callback\n * @param {Object} [that] Pass context (`this`) to the callback\n */\nEventBus.prototype.on = function(events, priority, callback, that) {\n\n  events = isArray(events) ? events : [ events ];\n\n  if (isFunction(priority)) {\n    that = callback;\n    callback = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (!isNumber(priority)) {\n    throw new Error('priority must be a number');\n  }\n\n  var actualCallback = callback;\n\n  if (that) {\n    actualCallback = bind(callback, that);\n\n    // make sure we remember and are able to remove\n    // bound callbacks via {@link #off} using the original\n    // callback\n    actualCallback[FN_REF] = callback[FN_REF] || callback;\n  }\n\n  var self = this;\n\n  events.forEach(function(e) {\n    self._addListener(e, {\n      priority: priority,\n      callback: actualCallback,\n      next: null\n    });\n  });\n};\n\n\n/**\n * Register an event listener that is executed only once.\n *\n * @param {string} event the event name to register for\n * @param {number} [priority=1000] the priority in which this listener is called, larger is higher\n * @param {Function} callback the callback to execute\n * @param {Object} [that] Pass context (`this`) to the callback\n */\nEventBus.prototype.once = function(event, priority, callback, that) {\n  var self = this;\n\n  if (isFunction(priority)) {\n    that = callback;\n    callback = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (!isNumber(priority)) {\n    throw new Error('priority must be a number');\n  }\n\n  function wrappedCallback() {\n    wrappedCallback.__isTomb = true;\n\n    var result = callback.apply(that, arguments);\n\n    self.off(event, wrappedCallback);\n\n    return result;\n  }\n\n  // make sure we remember and are able to remove\n  // bound callbacks via {@link #off} using the original\n  // callback\n  wrappedCallback[FN_REF] = callback;\n\n  this.on(event, priority, wrappedCallback);\n};\n\n\n/**\n * Removes event listeners by event and callback.\n *\n * If no callback is given, all listeners for a given event name are being removed.\n *\n * @param {string|Array<string>} events\n * @param {Function} [callback]\n */\nEventBus.prototype.off = function(events, callback) {\n\n  events = isArray(events) ? events : [ events ];\n\n  var self = this;\n\n  events.forEach(function(event) {\n    self._removeListener(event, callback);\n  });\n\n};\n\n\n/**\n * Create an EventBus event.\n *\n * @param {Object} data\n *\n * @return {Object} event, recognized by the eventBus\n */\nEventBus.prototype.createEvent = function(data) {\n  var event = new InternalEvent();\n\n  event.init(data);\n\n  return event;\n};\n\n\n/**\n * Fires a named event.\n *\n * @example\n *\n * // fire event by name\n * events.fire('foo');\n *\n * // fire event object with nested type\n * var event = { type: 'foo' };\n * events.fire(event);\n *\n * // fire event with explicit type\n * var event = { x: 10, y: 20 };\n * events.fire('element.moved', event);\n *\n * // pass additional arguments to the event\n * events.on('foo', function(event, bar) {\n *   alert(bar);\n * });\n *\n * events.fire({ type: 'foo' }, 'I am bar!');\n *\n * @param {string} [name] the optional event name\n * @param {Object} [event] the event object\n * @param {...Object} additional arguments to be passed to the callback functions\n *\n * @return {boolean} the events return value, if specified or false if the\n *                   default action was prevented by listeners\n */\nEventBus.prototype.fire = function(type, data) {\n  var event,\n      firstListener,\n      returnValue,\n      args;\n\n  args = slice.call(arguments);\n\n  if (typeof type === 'object') {\n    data = type;\n    type = data.type;\n  }\n\n  if (!type) {\n    throw new Error('no event type specified');\n  }\n\n  firstListener = this._listeners[type];\n\n  if (!firstListener) {\n    return;\n  }\n\n  // we make sure we fire instances of our home made\n  // events here. We wrap them only once, though\n  if (data instanceof InternalEvent) {\n\n    // we are fine, we alread have an event\n    event = data;\n  } else {\n    event = this.createEvent(data);\n  }\n\n  // ensure we pass the event as the first parameter\n  args[0] = event;\n\n  // original event type (in case we delegate)\n  var originalType = event.type;\n\n  // update event type before delegation\n  if (type !== originalType) {\n    event.type = type;\n  }\n\n  try {\n    returnValue = this._invokeListeners(event, args, firstListener);\n  } finally {\n\n    // reset event type after delegation\n    if (type !== originalType) {\n      event.type = originalType;\n    }\n  }\n\n  // set the return value to false if the event default\n  // got prevented and no other return value exists\n  if (returnValue === undefined && event.defaultPrevented) {\n    returnValue = false;\n  }\n\n  return returnValue;\n};\n\n\nEventBus.prototype.handleError = function(error) {\n  return this.fire('error', { error: error }) === false;\n};\n\n\nEventBus.prototype._destroy = function() {\n  this._listeners = {};\n};\n\nEventBus.prototype._invokeListeners = function(event, args, listener) {\n\n  var returnValue;\n\n  while (listener) {\n\n    // handle stopped propagation\n    if (event.cancelBubble) {\n      break;\n    }\n\n    returnValue = this._invokeListener(event, args, listener);\n\n    listener = listener.next;\n  }\n\n  return returnValue;\n};\n\nEventBus.prototype._invokeListener = function(event, args, listener) {\n\n  var returnValue;\n\n  if (listener.callback.__isTomb) {\n    return returnValue;\n  }\n\n  try {\n\n    // returning false prevents the default action\n    returnValue = invokeFunction(listener.callback, args);\n\n    // stop propagation on return value\n    if (returnValue !== undefined) {\n      event.returnValue = returnValue;\n      event.stopPropagation();\n    }\n\n    // prevent default on return false\n    if (returnValue === false) {\n      event.preventDefault();\n    }\n  } catch (error) {\n    if (!this.handleError(error)) {\n      console.error('unhandled error in event listener', error);\n\n      throw error;\n    }\n  }\n\n  return returnValue;\n};\n\n/*\n * Add new listener with a certain priority to the list\n * of listeners (for the given event).\n *\n * The semantics of listener registration / listener execution are\n * first register, first serve: New listeners will always be inserted\n * after existing listeners with the same priority.\n *\n * Example: Inserting two listeners with priority 1000 and 1300\n *\n *    * before: [ 1500, 1500, 1000, 1000 ]\n *    * after: [ 1500, 1500, (new=1300), 1000, 1000, (new=1000) ]\n *\n * @param {string} event\n * @param {Object} listener { priority, callback }\n */\nEventBus.prototype._addListener = function(event, newListener) {\n\n  var listener = this._getListeners(event),\n      previousListener;\n\n  // no prior listeners\n  if (!listener) {\n    this._setListeners(event, newListener);\n\n    return;\n  }\n\n  // ensure we order listeners by priority from\n  // 0 (high) to n > 0 (low)\n  while (listener) {\n\n    if (listener.priority < newListener.priority) {\n\n      newListener.next = listener;\n\n      if (previousListener) {\n        previousListener.next = newListener;\n      } else {\n        this._setListeners(event, newListener);\n      }\n\n      return;\n    }\n\n    previousListener = listener;\n    listener = listener.next;\n  }\n\n  // add new listener to back\n  previousListener.next = newListener;\n};\n\n\nEventBus.prototype._getListeners = function(name) {\n  return this._listeners[name];\n};\n\nEventBus.prototype._setListeners = function(name, listener) {\n  this._listeners[name] = listener;\n};\n\nEventBus.prototype._removeListener = function(event, callback) {\n\n  var listener = this._getListeners(event),\n      nextListener,\n      previousListener,\n      listenerCallback;\n\n  if (!callback) {\n\n    // clear listeners\n    this._setListeners(event, null);\n\n    return;\n  }\n\n  while (listener) {\n\n    nextListener = listener.next;\n\n    listenerCallback = listener.callback;\n\n    if (listenerCallback === callback || listenerCallback[FN_REF] === callback) {\n      if (previousListener) {\n        previousListener.next = nextListener;\n      } else {\n\n        // new first listener\n        this._setListeners(event, nextListener);\n      }\n    }\n\n    previousListener = listener;\n    listener = nextListener;\n  }\n};\n\n/**\n * A event that is emitted via the event bus.\n */\nfunction InternalEvent() { }\n\nInternalEvent.prototype.stopPropagation = function() {\n  this.cancelBubble = true;\n};\n\nInternalEvent.prototype.preventDefault = function() {\n  this.defaultPrevented = true;\n};\n\nInternalEvent.prototype.init = function(data) {\n  assign(this, data || {});\n};\n\n\n/**\n * Invoke function. Be fast...\n *\n * @param {Function} fn\n * @param {Array<Object>} args\n *\n * @return {Any}\n */\nfunction invokeFunction(fn, args) {\n  return fn.apply(null, args);\n}\n","import { isNil } from 'min-dash';\n\nexport default class Validator {\n\n  validateField(field, value) {\n\n    const { validate } = field;\n\n    let errors = [];\n\n    if (!validate) {\n      return errors;\n    }\n\n    if (validate.pattern && value && !new RegExp(validate.pattern).test(value)) {\n      errors = [\n        ...errors,\n        `Field must match pattern ${ validate.pattern }.`\n      ];\n    }\n\n    if (validate.required && (isNil(value) || value === '')) {\n      errors = [\n        ...errors,\n        'Field is required.'\n      ];\n    }\n\n    if ('min' in validate && value && value < validate.min) {\n      errors = [\n        ...errors,\n        `Field must have minimum value of ${ validate.min }.`\n      ];\n    }\n\n    if ('max' in validate && value && value > validate.max) {\n      errors = [\n        ...errors,\n        `Field must have maximum value of ${ validate.max }.`\n      ];\n    }\n\n    if ('minLength' in validate && value && value.trim().length < validate.minLength) {\n      errors = [\n        ...errors,\n        `Field must have minimum length of ${ validate.minLength }.`\n      ];\n    }\n\n    if ('maxLength' in validate && value && value.trim().length > validate.maxLength) {\n      errors = [\n        ...errors,\n        `Field must have maximum length of ${ validate.maxLength }.`\n      ];\n    }\n\n    return errors;\n  }\n}\n\nValidator.$inject = [];\n","import Ids from 'ids';\n\nexport default class FormFieldRegistry {\n  constructor(eventBus) {\n    this._eventBus = eventBus;\n\n    this._formFields = {};\n\n    eventBus.on('form.clear', () => this.clear());\n\n    this._ids = new Ids([ 32, 36, 1 ]);\n    this._keys = new Ids([ 32, 36, 1 ]);\n  }\n\n  add(formField) {\n    const { id } = formField;\n\n    if (this._formFields[ id ]) {\n      throw new Error(`form field with ID ${ id } already exists`);\n    }\n\n    this._eventBus.fire('formField.add', { formField });\n\n    this._formFields[ id ] = formField;\n  }\n\n  remove(formField) {\n    const { id } = formField;\n\n    if (!this._formFields[ id ]) {\n      return;\n    }\n\n    this._eventBus.fire('formField.remove', { formField });\n\n    delete this._formFields[ id ];\n  }\n\n  get(id) {\n    return this._formFields[ id ];\n  }\n\n  getAll() {\n    return Object.values(this._formFields);\n  }\n\n  forEach(callback) {\n    this.getAll().forEach((formField) => callback(formField));\n  }\n\n  clear() {\n    this._formFields = {};\n\n    this._ids.clear();\n    this._keys.clear();\n  }\n\n}\n\nFormFieldRegistry.$inject = [ 'eventBus' ];","import { Injector } from 'didi';\n\nexport function createInjector(bootstrapModules) {\n\n  const injector = new Injector(bootstrapModules);\n\n  injector.init();\n\n  return injector;\n}","/**\n * @param {string?} prefix\n *\n * @returns Element\n */\nexport function createFormContainer(prefix = 'fjs') {\n  const container = document.createElement('div');\n\n  container.classList.add(`${ prefix }-container`);\n\n  return container;\n}","export * from './injector';\nexport * from './form';\n\nexport function findErrors(errors, path) {\n  return errors[ pathStringify(path) ];\n}\n\nexport function isRequired(field) {\n  return field.required;\n}\n\nexport function pathParse(path) {\n  if (!path) {\n    return [];\n  }\n\n  return path.split('.').map(key => {\n    return isNaN(parseInt(key)) ? key : parseInt(key);\n  });\n}\n\nexport function pathsEqual(a, b) {\n  return (\n    a &&\n    b &&\n    a.length === b.length &&\n    a.every((value, index) => value === b[ index ])\n  );\n}\n\nexport function pathStringify(path) {\n  if (!path) {\n    return '';\n  }\n\n  return path.join('.');\n}\n\nconst indices = {};\n\nexport function generateIndexForType(type) {\n  if (type in indices) {\n    indices[ type ]++;\n  } else {\n    indices[ type ] = 1;\n  }\n\n  return indices[ type ];\n}\n\nexport function generateIdForType(type) {\n  return `${ type }${ generateIndexForType(type) }`;\n}\n\n/**\n * @template T\n * @param {T} data\n * @param {(this: any, key: string, value: any) => any} [replacer]\n * @return {T}\n */\nexport function clone(data, replacer) {\n  return JSON.parse(JSON.stringify(data, replacer));\n}\n\n/**\n * Parse the schema for input variables a form might make use of\n *\n * @param {any} schema\n *\n * @return {string[]}\n */\n\nexport function getSchemaVariables(schema) {\n\n  if (!schema.components) {\n    return [];\n  }\n\n  return schema.components.reduce((variables, component) => {\n\n    const {\n      key,\n      valuesKey,\n      type\n    } = component;\n\n    if ([ 'text', 'button' ].includes(type)) {\n      return variables;\n    }\n\n    if (key) {\n      variables = [ ...variables, key ];\n    }\n\n    if (valuesKey && !variables.includes(valuesKey)) {\n      variables = [ ...variables, valuesKey ];\n    }\n\n    return variables;\n\n  }, []);\n}","import {\n  get,\n  isUndefined\n} from 'min-dash';\n\nimport {\n  clone,\n  generateIdForType\n} from '../util';\n\n\nexport default class Importer {\n\n  /**\n   * @constructor\n   * @param { import('../core').FormFieldRegistry } formFieldRegistry\n   * @param { import('../render/FormFields').default } formFields\n   */\n  constructor(formFieldRegistry, formFields) {\n    this._formFieldRegistry = formFieldRegistry;\n    this._formFields = formFields;\n  }\n\n  /**\n   * Import schema adding `id`, `_parent` and `_path`\n   * information to each field and adding it to the\n   * form field registry.\n   *\n   * @param {any} schema\n   * @param {any} [data]\n   *\n   * @return { { warnings: Array<any>, schema: any, data: any } }\n   */\n  importSchema(schema, data = {}) {\n\n    // TODO: Add warnings - https://github.com/bpmn-io/form-js/issues/289\n    const warnings = [];\n\n    try {\n      const importedSchema = this.importFormField(clone(schema)),\n            importedData = this.importData(clone(data));\n\n      return {\n        warnings,\n        schema: importedSchema,\n        data: importedData\n      };\n    } catch (err) {\n      err.warnings = warnings;\n\n      throw err;\n    }\n  }\n\n  /**\n   * @param {any} formField\n   * @param {string} [parentId]\n   *\n   * @return {any} importedField\n   */\n  importFormField(formField, parentId) {\n    const {\n      components,\n      key,\n      type,\n      id = generateIdForType(type)\n    } = formField;\n\n    if (parentId) {\n\n      // set form field parent\n      formField._parent = parentId;\n    }\n\n    if (!this._formFields.get(type)) {\n      throw new Error(`form field of type <${ type }> not supported`);\n    }\n\n    if (key) {\n\n      // validate <key> uniqueness\n      if (this._formFieldRegistry._keys.assigned(key)) {\n        throw new Error(`form field with key <${ key }> already exists`);\n      }\n\n      this._formFieldRegistry._keys.claim(key, formField);\n\n      // TODO: buttons should not have key\n      if (type !== 'button') {\n\n        // set form field path\n        formField._path = [ key ];\n      }\n    }\n\n    if (id) {\n\n      // validate <id> uniqueness\n      if (this._formFieldRegistry._ids.assigned(id)) {\n        throw new Error(`form field with id <${ id }> already exists`);\n      }\n\n      this._formFieldRegistry._ids.claim(id, formField);\n    }\n\n    // set form field ID\n    formField.id = id;\n\n    this._formFieldRegistry.add(formField);\n\n    if (components) {\n      this.importFormFields(components, id);\n    }\n\n    return formField;\n  }\n\n  importFormFields(components, parentId) {\n    components.forEach((component) => {\n      this.importFormField(component, parentId);\n    });\n  }\n\n  /**\n   * @param {Object} data\n   *\n   * @return {Object} importedData\n   */\n  importData(data) {\n    return this._formFieldRegistry.getAll().reduce((importedData, formField) => {\n      const {\n        defaultValue,\n        _path,\n        type,\n        valuesKey\n      } = formField;\n\n      // get values defined via valuesKey\n\n      if (valuesKey) {\n        importedData = {\n          ...importedData,\n          [ valuesKey ]: get(data, [ valuesKey ])\n        };\n      }\n\n      // try to get value from data\n      // if unavailable - try to get default value from form field\n      // if unavailable - get empty value from form field\n\n      if (_path) {\n\n        const fieldImplementation = this._formFields.get(type);\n        let valueData = get(data, _path);\n\n        if (!isUndefined(valueData) && fieldImplementation.sanitizeValue) {\n          valueData = fieldImplementation.sanitizeValue({ formField, data, value: valueData });\n        }\n\n        const initialFieldValue = !isUndefined(valueData) ? valueData : (!isUndefined(defaultValue) ? defaultValue : fieldImplementation.emptyValue);\n\n        importedData = {\n          ...importedData,\n          [_path[0]]: initialFieldValue,\n        };\n      }\n\n      return importedData;\n\n    }, {});\n  }\n}\n\nImporter.$inject = [ 'formFieldRegistry', 'formFields' ];","import Importer from './Importer';\n\nexport default {\n  importer: [ 'type', Importer ]\n};","const NODE_TYPE_TEXT = 3,\n      NODE_TYPE_ELEMENT = 1;\n\nconst ALLOWED_NODES = [\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'span',\n  'em',\n  'a',\n  'p',\n  'div',\n  'ul',\n  'ol',\n  'li',\n  'hr',\n  'blockquote',\n  'img',\n  'pre',\n  'code',\n  'br',\n  'strong'\n];\n\nconst ALLOWED_ATTRIBUTES = [\n  'align',\n  'alt',\n  'class',\n  'href',\n  'id',\n  'name',\n  'rel',\n  'target',\n  'src'\n];\n\nconst ALLOWED_URI_PATTERN = /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i; // eslint-disable-line no-useless-escape\nconst ATTR_WHITESPACE_PATTERN = /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g; // eslint-disable-line no-control-regex\n\nconst FORM_ELEMENT = document.createElement('form');\n\n/**\n * Sanitize a HTML string and return the cleaned, safe version.\n *\n * @param {string} html\n * @return {string}\n */\nexport function sanitizeHTML(html) {\n\n  const doc = new DOMParser().parseFromString(\n    `<!DOCTYPE html>\\n<html><body><div>${ html }`,\n    'text/html'\n  );\n\n  doc.normalize();\n\n  const element = doc.body.firstChild;\n\n  if (element) {\n    sanitizeNode(/** @type Element */ (element));\n\n    return new XMLSerializer().serializeToString(element);\n  } else {\n\n    // handle the case that document parsing\n    // does not work at all, due to HTML gibberish\n    return '';\n  }\n}\n\n/**\n * Recursively sanitize a HTML node, potentially\n * removing it, its children or attributes.\n *\n * Inspired by https://github.com/developit/snarkdown/issues/70\n * and https://github.com/cure53/DOMPurify. Simplified\n * for our use-case.\n *\n * @param {Element} node\n */\nfunction sanitizeNode(node) {\n\n  // allow text nodes\n  if (node.nodeType === NODE_TYPE_TEXT) {\n    return;\n  }\n\n  // disallow all other nodes but Element\n  if (node.nodeType !== NODE_TYPE_ELEMENT) {\n    return node.remove();\n  }\n\n  const lcTag = node.tagName.toLowerCase();\n\n  // disallow non-whitelisted tags\n  if (!ALLOWED_NODES.includes(lcTag)) {\n    return node.remove();\n  }\n\n  const attributes = node.attributes;\n\n  // clean attributes\n  for (let i = attributes.length; i--;) {\n    const attribute = attributes[i];\n\n    const name = attribute.name;\n    const lcName = name.toLowerCase();\n\n    // normalize node value\n    const value = attribute.value.trim();\n\n    node.removeAttribute(name);\n\n    const valid = isValidAttribute(lcTag, lcName, value);\n\n    if (valid) {\n      node.setAttribute(name, value);\n    }\n\n  }\n\n  // force noopener on target=\"_blank\" links\n  if (lcTag === 'a' && node.getAttribute('target') === '_blank' && node.getAttribute('rel') !== 'noopener') {\n    node.setAttribute('rel', 'noopener');\n  }\n\n  for (let i = node.childNodes.length; i--;) {\n    sanitizeNode(/** @type Element */ (node.childNodes[i]));\n  }\n}\n\n\n/**\n * Validates attributes for validity.\n *\n * @param {string} lcTag\n * @param {string} lcName\n * @param {string} value\n * @return {boolean}\n */\nfunction isValidAttribute(lcTag, lcName, value) {\n\n  // disallow most attributes based on whitelist\n  if (!ALLOWED_ATTRIBUTES.includes(lcName)) {\n    return false;\n  }\n\n  // disallow \"DOM clobbering\" / polution of document and wrapping form elements\n  if ((lcName === 'id' || lcName === 'name') && (value in document || value in FORM_ELEMENT)) {\n    return false;\n  }\n\n  if (lcName === 'target' && value !== '_blank') {\n    return false;\n  }\n\n  // allow valid url links only\n  if (lcName === 'href' && !ALLOWED_URI_PATTERN.test(value.replace(ATTR_WHITESPACE_PATTERN, ''))) {\n    return false;\n  }\n\n  return true;\n}","import snarkdown from '@bpmn-io/snarkdown';\nimport { get } from 'min-dash';\n\nimport { sanitizeHTML } from './Sanitizer';\n\nexport function formFieldClasses(type, errors = []) {\n  if (!type) {\n    throw new Error('type required');\n  }\n\n  const classes = [\n    'fjs-form-field',\n    `fjs-form-field-${ type }`\n  ];\n\n  if (errors.length) {\n    classes.push('fjs-has-errors');\n  }\n\n  return classes.join(' ');\n}\n\nexport function prefixId(id, formId) {\n  if (formId) {\n    return `fjs-form-${ formId }-${ id }`;\n  }\n\n  return `fjs-form-${ id }`;\n}\n\nexport function markdownToHTML(markdown) {\n  const htmls = markdown\n    .split(/(?:\\r?\\n){2,}/)\n    .map(line =>\n      /^((\\d+.)|[><\\s#-*])/.test(line)\n        ? snarkdown(line)\n        : `<p>${ snarkdown(line) }</p>`,\n    );\n\n  return htmls.join('\\n\\n');\n}\n\n// see https://github.com/developit/snarkdown/issues/70\nexport function safeMarkdown(markdown) {\n  const html = markdownToHTML(markdown);\n\n  return sanitizeHTML(html);\n}\n\nexport function sanitizeSingleSelectValue(options) {\n  const {\n    formField,\n    data,\n    value\n  } = options;\n\n  const {\n    valuesKey,\n    values\n  } = formField;\n\n  try {\n    const validValues = (valuesKey ? get(data, [ valuesKey ]) : values).map(v => v.value) || [];\n    return validValues.includes(value) ? value : null;\n  } catch (error) {\n\n    // use default value in case of formatting error\n    // TODO(@Skaiir): log a warning when this happens - https://github.com/bpmn-io/form-js/issues/289\n    return null;\n  }\n}\n\nexport function sanitizeMultiSelectValue(options) {\n  const {\n    formField,\n    data,\n    value\n  } = options;\n\n  const {\n    valuesKey,\n    values\n  } = formField;\n\n  try {\n    const validValues = (valuesKey ? get(data, [ valuesKey ]) : values).map(v => v.value) || [];\n    return value.filter(v => validValues.includes(v));\n  } catch (error) {\n\n    // use default value in case of formatting error\n    // TODO(@Skaiir): log a warning when this happens - https://github.com/bpmn-io/form-js/issues/289\n    return [];\n  }\n}\n","import { formFieldClasses } from '../Util';\n\nconst type = 'button';\n\n\nexport default function Button(props) {\n  const {\n    disabled,\n    field\n  } = props;\n\n  const { action = 'submit' } = field;\n\n  return <div class={ formFieldClasses(type) }>\n    <button class=\"fjs-button\" type={ action } disabled={ disabled }>{ field.label }</button>\n  </div>;\n}\n\nButton.create = function(options = {}) {\n\n  return {\n    action: 'submit',\n    ...options\n  };\n};\n\nButton.type = type;\nButton.label = 'Button';\nButton.keyed = true;","import { createContext } from 'preact';\n\nconst FormRenderContext = createContext({\n  Empty: (props) => {\n    return null;\n  },\n  Children: (props) => {\n    return props.children;\n  },\n  Element: (props) => {\n    return props.children;\n  }\n});\n\nexport default FormRenderContext;","import { createContext } from 'preact';\n\n/**\n * @param {string} type\n * @param {boolean} [strict]\n *\n * @returns {any}\n */\nfunction getService(type, strict) {}\n\nconst FormContext = createContext({\n  getService,\n  formId: null\n});\n\nexport default FormContext;","export default function Description(props) {\n  const { description } = props;\n\n  if (!description) {\n    return null;\n  }\n\n  return <div class=\"fjs-form-field-description\">{ description }</div>;\n}","export default function Errors(props) {\n  const { errors } = props;\n\n  if (!errors.length) {\n    return null;\n  }\n\n  return <div class=\"fjs-form-field-error\">\n    <ul>\n      {\n        errors.map(error => {\n          return <li>{ error }</li>;\n        })\n      }\n    </ul>\n  </div>;\n}","export default function Label(props) {\n  const {\n    id,\n    label,\n    required = false\n  } = props;\n\n  return (\n    <label for={ id } class=\"fjs-form-field-label\">\n      { props.children }\n      { label || '' }\n      {\n        required && <span class=\"fjs-asterix\">*</span>\n      }\n    </label>\n  );\n}","import { useContext } from 'preact/hooks';\n\nimport { FormContext } from '../../context';\n\nimport Description from '../Description';\nimport Errors from '../Errors';\nimport Label from '../Label';\n\nimport {\n  formFieldClasses,\n  prefixId\n} from '../Util';\n\nconst type = 'checkbox';\n\n\nexport default function Checkbox(props) {\n  const {\n    disabled,\n    errors = [],\n    field,\n    value = false\n  } = props;\n\n  const {\n    description,\n    id,\n    label\n  } = field;\n\n  const onChange = ({ target }) => {\n    props.onChange({\n      field,\n      value: target.checked\n    });\n  };\n\n  const { formId } = useContext(FormContext);\n\n  return <div class={ formFieldClasses(type, errors) }>\n    <Label\n      id={ prefixId(id, formId) }\n      label={ label }\n      required={ false }>\n      <input\n        checked={ value }\n        class=\"fjs-input\"\n        disabled={ disabled }\n        id={ prefixId(id, formId) }\n        type=\"checkbox\"\n        onChange={ onChange } />\n    </Label>\n    <Description description={ description } />\n    <Errors errors={ errors } />\n  </div>;\n}\n\nCheckbox.create = function(options = {}) {\n  return {\n    ...options\n  };\n};\n\nCheckbox.type = type;\nCheckbox.label = 'Checkbox';\nCheckbox.keyed = true;\nCheckbox.emptyValue = false;\nCheckbox.sanitizeValue = ({ value }) => value === true;","import {\n  useContext\n} from 'preact/hooks';\n\nimport { FormContext } from '../context';\n\n\nexport default function(type, strict) {\n  const {\n    getService\n  } = useContext(FormContext);\n\n  return getService(type, strict);\n}","import { useEffect, useState } from 'preact/hooks';\nimport useService from './useService';\n\n/**\n * @enum { String }\n */\nexport const LOAD_STATES = {\n  LOADING: 'loading',\n  LOADED: 'loaded',\n  ERROR: 'error'\n};\n\n/**\n * @typedef {Object} ValuesGetter\n * @property {Object[]} values - The values data\n * @property {(LOAD_STATES)} state - The values data's loading state, to use for conditional rendering\n */\n\n/**\n * A hook to load values for single and multiselect components.\n *\n * @param {Object} field - The form field to handle values for\n * @return {ValuesGetter} valuesGetter - A values getter object providing loading state and values\n */\nexport default function(field) {\n  const {\n    valuesKey,\n    values: staticValues\n  } = field;\n\n  const [ valuesGetter, setValuesGetter ] = useState({ values: [], error: undefined, state: LOAD_STATES.LOADING });\n  const initialData = useService('form')._getState().initialData;\n\n  useEffect(() => {\n\n    let values = [];\n\n    if (valuesKey !== undefined) {\n\n      const keyedValues = (initialData || {})[ valuesKey ];\n\n      if (keyedValues && Array.isArray(keyedValues)) {\n        values = keyedValues;\n      }\n    }\n    else if (staticValues !== undefined) {\n      values = Array.isArray(staticValues) ? staticValues : [];\n    }\n    else {\n      setValuesGetter(getErrorState('No values source defined in the form definition'));\n      return;\n    }\n\n    setValuesGetter(buildLoadedState(values));\n\n  }, [ valuesKey, staticValues, initialData ]);\n\n  return valuesGetter;\n}\n\nconst getErrorState = (error) => ({ values: [], error, state: LOAD_STATES.ERROR });\n\nconst buildLoadedState = (values) => ({ values, error: undefined, state: LOAD_STATES.LOADED });\n","import { useContext } from 'preact/hooks';\nimport useValuesAsync, { LOAD_STATES } from '../../hooks/useValuesAsync';\n\nimport { FormContext } from '../../context';\n\nimport Description from '../Description';\nimport Errors from '../Errors';\nimport Label from '../Label';\n\nimport {\n  formFieldClasses,\n  prefixId,\n  sanitizeMultiSelectValue\n} from '../Util';\n\nconst type = 'checklist';\n\n\nexport default function Checklist(props) {\n  const {\n    disabled,\n    errors = [],\n    field,\n    value = [],\n  } = props;\n\n  const {\n    description,\n    id,\n    label\n  } = field;\n\n  const toggleCheckbox = (v) => {\n\n    let newValue = [ ...value ];\n\n    if (!newValue.includes(v)) {\n      newValue.push(v);\n    } else {\n      newValue = newValue.filter(x => x != v);\n    }\n\n    props.onChange({\n      field,\n      value: newValue,\n    });\n  };\n\n  const {\n    state: loadState,\n    values: options\n  } = useValuesAsync(field);\n\n  const { formId } = useContext(FormContext);\n\n  return <div class={ formFieldClasses(type, errors) }>\n    <Label\n      label={ label } />\n    {\n      loadState == LOAD_STATES.LOADED && options.map((v, index) => {\n        return (\n          <Label\n            id={ prefixId(`${id}-${index}`, formId) }\n            key={ `${id}-${index}` }\n            label={ v.label }\n            required={ false }>\n            <input\n              checked={ value.includes(v.value) }\n              class=\"fjs-input\"\n              disabled={ disabled }\n              id={ prefixId(`${id}-${index}`, formId) }\n              type=\"checkbox\"\n              onClick={ () => toggleCheckbox(v.value) } />\n          </Label>\n        );\n      })\n    }\n    <Description description={ description } />\n    <Errors errors={ errors } />\n  </div>;\n}\n\nChecklist.create = function(options = {}) {\n\n  if (options.valuesKey) return options;\n\n  return {\n    values: [\n      {\n        label: 'Value',\n        value: 'value'\n      }\n    ],\n    ...options\n  };\n};\n\nChecklist.type = type;\nChecklist.label = 'Checklist';\nChecklist.keyed = true;\nChecklist.emptyValue = [];\nChecklist.sanitizeValue = sanitizeMultiSelectValue;","import { useContext } from 'preact/hooks';\n\nimport { get } from 'min-dash';\n\nimport { FormRenderContext } from '../context';\n\nimport useService from '../hooks/useService';\n\nimport { findErrors } from '../../util';\n\nconst noop = () => false;\n\n\nexport default function FormField(props) {\n  const {\n    field,\n    onChange\n  } = props;\n\n  const { _path } = field;\n\n  const formFields = useService('formFields'),\n        form = useService('form');\n\n  const {\n    data,\n    errors,\n    properties\n  } = form._getState();\n\n  const {\n    Element\n  } = useContext(FormRenderContext);\n\n  const FormFieldComponent = formFields.get(field.type);\n\n  if (!FormFieldComponent) {\n    throw new Error(`cannot render field <${field.type}>`);\n  }\n\n  const value = get(data, _path);\n\n  const fieldErrors = findErrors(errors, _path);\n\n  const disabled = properties.readOnly || field.disabled || false;\n\n  return (\n    <Element field={ field }>\n      <FormFieldComponent\n        { ...props }\n        disabled={ disabled }\n        errors={ fieldErrors }\n        onChange={ disabled ? noop : onChange }\n        value={ value } />\n    </Element>\n  );\n}","import { useContext } from 'preact/hooks';\n\nimport FormField from '../FormField';\n\nimport { FormRenderContext } from '../../context';\n\n\nexport default function Default(props) {\n  const {\n    Children,\n    Empty\n  } = useContext(FormRenderContext);\n\n  const { field } = props;\n\n  const { components = [] } = field;\n\n  return <Children class=\"fjs-vertical-layout\" field={ field }>\n    {\n      components.map(childField => {\n        return (\n          <FormField\n            { ...props }\n            key={ childField.id }\n            field={ childField } />\n        );\n      })\n    }\n    {\n      components.length ? null : <Empty />\n    }\n  </Children>;\n}\n\nDefault.create = function(options = {}) {\n  return {\n    components: [],\n    ...options\n  };\n};\n\nDefault.type = 'default';\nDefault.keyed = false;","/**\n * This file must not be changed or exchanged.\n *\n * @see http://bpmn.io/license for more information.\n */\nimport { Fragment } from 'preact';\nimport { useState } from 'preact/hooks';\nimport { createPortal } from 'preact/compat';\n\nfunction Logo() {\n  return <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14.02 5.57\" width=\"53\" height=\"21\" style=\"vertical-align:middle\"><path fill=\"currentColor\" d=\"M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z\" /><path fill=\"currentColor\" d=\"M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z\" /></svg>;\n}\n\nfunction Lightbox(props) {\n  const { open } = props;\n\n  if (!open) {\n    return null;\n  }\n\n  return (\n    <div class=\"fjs-powered-by-lightbox\" style=\"z-index: 100; position: fixed; top: 0; left: 0;right: 0; bottom: 0\">\n      <div class=\"backdrop\" style=\"width: 100%; height: 100%; background: rgba(40 40 40 / 20%)\" onClick={ props.onBackdropClick }></div>\n      <div class=\"notice\" style=\"position: absolute; left: 50%; top: 40%; transform: translate(-50%); width: 260px; padding: 10px; background: white; box-shadow: 0  1px 4px rgba(0 0 0 / 30%); font-family: Helvetica, Arial, sans-serif; font-size: 14px; display: flex; line-height: 1.3\">\n        <a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\" style=\"margin: 15px 20px 15px 10px; align-self: center; color: #404040\">\n          <Logo />\n        </a>\n        <span>\n          Web-based tooling for BPMN, DMN, and forms\n          powered by <a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\">bpmn.io</a>.\n        </span>\n      </div>\n    </div>\n  );\n}\n\nfunction Link(props) {\n  return (\n    <div class=\"fjs-powered-by fjs-form-field\" style=\"text-align: right\">\n      <a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\" class=\"fjs-powered-by-link\" title=\"Powered by bpmn.io\" style=\"color: #404040\" onClick={ props.onClick }><Logo /></a>\n    </div>\n  );\n}\n\nexport default function PoweredBy(props) {\n\n  const [ open, setOpen ] = useState(false);\n\n  function toggleOpen(open) {\n    return (event) => {\n      event.preventDefault();\n\n      setOpen(open);\n    };\n  }\n\n  return (\n    <Fragment>\n      {\n        createPortal(\n          <Lightbox open={ open } onBackdropClick={ toggleOpen(false) } />,\n          document.body\n        )\n      }\n      <Link onClick={ toggleOpen(true) } />\n    </Fragment>\n  );\n}","import FormField from './FormField';\n\nimport PoweredBy from './PoweredBy';\n\nimport useService from '../hooks/useService';\n\nconst noop = () => {};\n\nexport default function FormComponent(props) {\n  const form = useService('form');\n\n  const { schema } = form._getState();\n\n  const {\n    onSubmit = noop,\n    onReset = noop,\n    onChange = noop,\n  } = props;\n\n  const handleSubmit = (event) => {\n    event.preventDefault();\n\n    onSubmit();\n  };\n\n  const handleReset = (event) => {\n    event.preventDefault();\n\n    onReset();\n  };\n\n  return (\n    <form\n      class=\"fjs-form\"\n      onSubmit={ handleSubmit }\n      onReset={ handleReset }\n    >\n      <FormField\n        field={ schema }\n        onChange={ onChange }\n      />\n\n      <PoweredBy />\n    </form>\n  );\n}","import { useContext } from 'preact/hooks';\n\nimport { FormContext } from '../../context';\n\nimport Description from '../Description';\nimport Errors from '../Errors';\nimport Label from '../Label';\n\nimport {\n  formFieldClasses,\n  prefixId\n} from '../Util';\n\nconst type = 'number';\n\n\nexport default function Number(props) {\n  const {\n    disabled,\n    errors = [],\n    field,\n    value\n  } = props;\n\n  const {\n    description,\n    id,\n    label,\n    validate = {}\n  } = field;\n\n  const { required } = validate;\n\n  const onChange = ({ target }) => {\n    props.onChange({\n      field,\n      value: Number.sanitizeValue({ value: target.value })\n    });\n  };\n\n  const { formId } = useContext(FormContext);\n\n  return <div class={ formFieldClasses(type, errors) }>\n    <Label\n      id={ prefixId(id, formId) }\n      label={ label }\n      required={ required } />\n    <input\n      class=\"fjs-input\"\n      disabled={ disabled }\n      id={ prefixId(id, formId) }\n      onInput={ onChange }\n      type=\"number\"\n      value={ value || '' } />\n    <Description description={ description } />\n    <Errors errors={ errors } />\n  </div>;\n}\n\nNumber.create = function(options = {}) {\n  return {\n    ...options\n  };\n};\n\nNumber.sanitizeValue = ({ value }) => {\n  const parsedValue = parseInt(value, 10);\n  return isNaN(parsedValue) ? null : parsedValue;\n};\n\nNumber.type = type;\nNumber.keyed = true;\nNumber.label = 'Number';\nNumber.emptyValue = null;","import { useContext } from 'preact/hooks';\nimport useValuesAsync, { LOAD_STATES } from '../../hooks/useValuesAsync';\n\nimport { FormContext } from '../../context';\n\nimport Description from '../Description';\nimport Errors from '../Errors';\nimport Label from '../Label';\n\nimport {\n  formFieldClasses,\n  prefixId,\n  sanitizeSingleSelectValue\n} from '../Util';\n\nconst type = 'radio';\n\n\nexport default function Radio(props) {\n  const {\n    disabled,\n    errors = [],\n    field,\n    value\n  } = props;\n\n  const {\n    description,\n    id,\n    label,\n    validate = {}\n  } = field;\n\n  const { required } = validate;\n\n  const onChange = (v) => {\n    props.onChange({\n      field,\n      value: v\n    });\n  };\n\n  const {\n    state: loadState,\n    values: options\n  } = useValuesAsync(field);\n\n  const { formId } = useContext(FormContext);\n\n  return <div class={ formFieldClasses(type, errors) }>\n    <Label\n      label={ label }\n      required={ required } />\n    {\n      loadState == LOAD_STATES.LOADED && options.map((option, index) => {\n        return (\n          <Label\n            id={ prefixId(`${ id }-${ index }`, formId) }\n            key={ `${ id }-${ index }` }\n            label={ option.label }\n            required={ false }>\n            <input\n              checked={ option.value === value }\n              class=\"fjs-input\"\n              disabled={ disabled }\n              id={ prefixId(`${ id }-${ index }`, formId) }\n              type=\"radio\"\n              onClick={ () => onChange(option.value) } />\n          </Label>\n        );\n      })\n    }\n    <Description description={ description } />\n    <Errors errors={ errors } />\n  </div>;\n}\n\nRadio.create = function(options = {}) {\n\n  if (options.valuesKey) return options;\n\n  return {\n    values: [\n      {\n        label: 'Value',\n        value: 'value'\n      }\n    ],\n    ...options\n  };\n};\n\nRadio.type = type;\nRadio.label = 'Radio';\nRadio.keyed = true;\nRadio.emptyValue = null;\nRadio.sanitizeValue = sanitizeSingleSelectValue;","import { useContext } from 'preact/hooks';\nimport useOptionsAsync, { LOAD_STATES } from '../../hooks/useValuesAsync';\n\nimport { FormContext } from '../../context';\n\nimport Description from '../Description';\nimport Errors from '../Errors';\nimport Label from '../Label';\n\nimport {\n  formFieldClasses,\n  prefixId,\n  sanitizeSingleSelectValue\n} from '../Util';\n\nconst type = 'select';\n\nexport default function Select(props) {\n  const {\n    disabled,\n    errors = [],\n    field,\n    value\n  } = props;\n\n  const {\n    description,\n    id,\n    label,\n    validate = {}\n  } = field;\n\n  const { required } = validate;\n\n  const onChange = ({ target }) => {\n    props.onChange({\n      field,\n      value: target.value === '' ? null : target.value\n    });\n  };\n\n  const {\n    state: loadState,\n    values: options\n  } = useOptionsAsync(field);\n\n  const { formId } = useContext(FormContext);\n\n  return <div class={ formFieldClasses(type, errors) }>\n    <Label\n      id={ prefixId(id, formId) }\n      label={ label }\n      required={ required } />\n    <select\n      class=\"fjs-select\"\n      disabled={ disabled }\n      id={ prefixId(id, formId) }\n      onChange={ onChange }\n      value={ value || '' }>\n      <option value=\"\"></option>\n      {\n        loadState == LOAD_STATES.LOADED && options.map((option, index) => {\n          return (\n            <option\n              key={ `${ id }-${ index }` }\n              value={ option.value }>\n              { option.label }\n            </option>\n          );\n        })\n      }\n    </select>\n    <Description description={ description } />\n    <Errors errors={ errors } />\n  </div>;\n}\n\nSelect.create = function(options = {}) {\n\n  if (options.valuesKey) return options;\n\n  return {\n    values: [\n      {\n        label: 'Value',\n        value: 'value'\n      }\n    ],\n    ...options\n  };\n};\n\nSelect.type = type;\nSelect.label = 'Select';\nSelect.keyed = true;\nSelect.emptyValue = null;\nSelect.sanitizeValue = sanitizeSingleSelectValue;","function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\nexport default (({\n  styles = {},\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  width: \"16\",\n  height: \"16\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\"\n}, props), /*#__PURE__*/React.createElement(\"path\", {\n  fillRule: \"evenodd\",\n  clipRule: \"evenodd\",\n  d: \"M12 4.7l-.7-.7L8 7.3 4.7 4l-.7.7L7.3 8 4 11.3l.7.7L8 8.7l3.3 3.3.7-.7L8.7 8 12 4.7z\",\n  fill: \"#000\"\n})));","import { useEffect } from 'preact/hooks';\n\nexport default function useKeyDownAction(targetKey, action, listenerElement = window) {\n\n  function downHandler({ key }) {\n    if (key === targetKey) {\n      action();\n    }\n  }\n\n  useEffect(() => {\n    listenerElement.addEventListener('keydown', downHandler);\n\n    return () => {\n      listenerElement.removeEventListener('keydown', downHandler);\n    };\n  });\n}","import { useState, useEffect, useCallback, useRef, useMemo } from 'preact/hooks';\nimport useKeyDownAction from '../../../hooks/useKeyDownAction';\n\nconst DEFAULT_LABEL_GETTER = (value) => value;\nconst NOOP = () => {};\n\nexport default function DropdownList(props) {\n\n  const {\n    keyEventsListener = window,\n    values = [],\n    getLabel = DEFAULT_LABEL_GETTER,\n    onValueSelected = NOOP,\n    height = 235,\n    emptyListMessage = 'No results',\n  } = props;\n\n  const [ mouseControl, setMouseControl ] = useState(true);\n  const [ focusedValueIndex, setFocusedValueIndex ] = useState(0);\n  const dropdownContainer = useRef();\n  const mouseScreenPos = useRef();\n\n  const focusedItem = useMemo(() => values.length ? values[focusedValueIndex] : null, [ focusedValueIndex, values ]);\n\n  const changeFocusedValueIndex = useCallback((delta) => {\n    setFocusedValueIndex(x => Math.min(Math.max(0, x + delta), values.length - 1));\n  }, [ values.length ]);\n\n  useEffect(() => {\n    if (focusedValueIndex === 0) return;\n\n    if (!focusedValueIndex || !values.length) {\n      setFocusedValueIndex(0);\n    }\n    else if (focusedValueIndex >= values.length) {\n      setFocusedValueIndex(values.length - 1);\n    }\n  }, [ focusedValueIndex, values.length ]);\n\n  useKeyDownAction('ArrowUp', () => {\n    if (values.length) {\n      changeFocusedValueIndex(-1);\n      setMouseControl(false);\n    }\n  }, keyEventsListener);\n\n  useKeyDownAction('ArrowDown', () => {\n    if (values.length) {\n      changeFocusedValueIndex(1);\n      setMouseControl(false);\n    }\n  }, keyEventsListener);\n\n  useKeyDownAction('Enter', () => {\n    if (focusedItem) {\n      onValueSelected(focusedItem);\n    }\n  }, keyEventsListener);\n\n  useEffect(() => {\n    const individualEntries = dropdownContainer.current.children;\n    if (individualEntries.length && !mouseControl) {\n      individualEntries[focusedValueIndex].scrollIntoView({ block: 'nearest', inline: 'nearest' });\n    }\n  }, [ focusedValueIndex, mouseControl ]);\n\n  const mouseMove = (e, i) => {\n    const userMoved = !mouseScreenPos.current || mouseScreenPos.current.x !== e.screenX && mouseScreenPos.current.y !== e.screenY;\n\n    if (userMoved) {\n      mouseScreenPos.current = { x: e.screenX, y: e.screenY };\n\n      if (!mouseControl) {\n        setMouseControl(true);\n        setFocusedValueIndex(i);\n      }\n    }\n  };\n\n  return <div\n    ref={ dropdownContainer }\n    tabIndex={ -1 }\n    class=\"fjs-dropdownlist\"\n    style={ { maxHeight: height } }>\n    {\n      !!values.length && values.map((v, i) => {\n        return (\n          <div\n            class={ 'fjs-dropdownlist-item' + (focusedValueIndex === i ? ' focused' : '') }\n            onMouseMove={ (e) => mouseMove(e, i) }\n            onMouseEnter={ mouseControl ? () => setFocusedValueIndex(i) : undefined }\n            onMouseDown={ (e) => { e.preventDefault(); onValueSelected(v); } }>\n            {getLabel(v)}\n          </div>\n        );\n      })\n    }\n    {\n      !values.length && <div class=\"fjs-dropdownlist-empty\">{ emptyListMessage }</div>\n    }\n  </div>;\n}","import { useContext, useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport useValuesAsync, { LOAD_STATES } from '../../hooks/useValuesAsync';\n\nimport { FormContext } from '../../context';\n\nimport CloseIcon from './icons/Close.svg';\n\nimport Description from '../Description';\nimport Errors from '../Errors';\nimport Label from '../Label';\n\nimport {\n  formFieldClasses,\n  prefixId,\n  sanitizeMultiSelectValue\n} from '../Util';\n\nimport classNames from 'classnames';\n\nimport DropdownList from './parts/DropdownList';\n\nconst type = 'taglist';\n\n\nexport default function Taglist(props) {\n  const {\n    disabled,\n    errors = [],\n    field,\n    value : values = []\n  } = props;\n\n  const {\n    description,\n    id,\n    label\n  } = field;\n\n  const { formId } = useContext(FormContext);\n  const [ filter, setFilter ] = useState('');\n  const [ filteredOptions, setFilteredOptions ] = useState([]);\n  const [ isDropdownExpanded, setIsDropdownExpanded ] = useState(false);\n  const [ hasOptionsLeft, setHasOptionsLeft ] = useState(true);\n  const [ isEscapeClosed, setIsEscapeClose ] = useState(false);\n  const searchbarRef = useRef();\n\n  const {\n    state: loadState,\n    values: options\n  } = useValuesAsync(field);\n\n  // We cache a map of option values to their index so that we don't need to search the whole options array every time to correlate the label\n  const valueToOptionMap = useMemo(() => Object.assign({}, ...options.map((o, x) => ({ [o.value]:  options[x] }))), [ options ]);\n\n  // Usage of stringify is necessary here because we want this effect to only trigger when there is a value change to the array\n  useEffect(() => {\n    if (loadState === LOAD_STATES.LOADED) {\n      setFilteredOptions(options.filter((o) => o.label && o.value && (o.label.toLowerCase().includes(filter.toLowerCase())) && !values.includes(o.value)));\n    }\n    else {\n      setFilteredOptions([]);\n    }\n  }, [ filter, JSON.stringify(values), options, loadState ]);\n\n  useEffect(() => {\n    setHasOptionsLeft(options.length > values.length);\n  }, [ options.length, values.length ]);\n\n  const onFilterChange = ({ target }) => {\n    setIsEscapeClose(false);\n    setFilter(target.value);\n  };\n\n  const selectValue = (value) => {\n    if (filter) {\n      setFilter('');\n    }\n\n    // Ensure values cannot be double selected due to latency\n    if (values.at(-1) === value) {\n      return;\n    }\n\n    props.onChange({ value: [ ...values, value ], field });\n  };\n\n  const deselectValue = (value) => {\n    props.onChange({ value: values.filter((v) => v != value), field });\n  };\n\n  const onInputKeyDown = (e) => {\n\n    switch (e.key) {\n    case 'ArrowUp':\n    case 'ArrowDown':\n\n      // We do not want the cursor to seek in the search field when we press up and down\n      e.preventDefault();\n      break;\n    case 'Backspace':\n      if (!filter && values.length) {\n        deselectValue(values[values.length - 1]);\n      }\n      break;\n    case 'Escape':\n      setIsEscapeClose(true);\n      break;\n    case 'Enter':\n      if (isEscapeClosed) {\n        setIsEscapeClose(false);\n      }\n      break;\n    }\n  };\n\n  return <div class={ formFieldClasses(type, errors) }>\n    <Label\n      label={ label }\n      id={ prefixId(id, formId) } />\n    <div class={ classNames('fjs-taglist', { 'disabled': disabled }) }>\n      {!disabled && loadState === LOAD_STATES.LOADED &&\n        values.map((v) => {\n          return (\n            <div class=\"fjs-taglist-tag\" onMouseDown={ (e) => e.preventDefault() }>\n              <span class=\"fjs-taglist-tag-label\">\n                {valueToOptionMap[v] ? valueToOptionMap[v].label : `unexpected value{${v}}`}\n              </span>\n              <span class=\"fjs-taglist-tag-remove\" onMouseDown={ () => deselectValue(v) }><CloseIcon /></span>\n            </div>\n          );\n        })\n      }\n      <input\n        disabled={ disabled }\n        class=\"fjs-taglist-input\"\n        ref={ searchbarRef }\n        id={ prefixId(`${id}-search`, formId) }\n        onChange={ onFilterChange }\n        type=\"text\"\n        value={ filter }\n        placeholder={ 'Search' }\n        autoComplete=\"off\"\n        onKeyDown={ (e) => onInputKeyDown(e) }\n        onMouseDown={ () => setIsEscapeClose(false) }\n        onFocus={ () => setIsDropdownExpanded(true) }\n        onBlur={ () => { setIsDropdownExpanded(false); setFilter(''); } } />\n    </div>\n    <div class=\"fjs-taglist-anchor\">\n      {!disabled && loadState === LOAD_STATES.LOADED && isDropdownExpanded && !isEscapeClosed && <DropdownList\n        values={ filteredOptions }\n        getLabel={ (o) => o.label }\n        onValueSelected={ (o) => selectValue(o.value) }\n        emptyListMessage={ hasOptionsLeft ? 'No results' : 'All values selected' }\n        listenerElement={ searchbarRef.current } />}\n    </div>\n    <Description description={ description } />\n    <Errors errors={ errors } />\n  </div>;\n}\n\nTaglist.create = function(options = {}) {\n\n  if (options.valuesKey) return options;\n\n  return {\n    values: [\n      {\n        label: 'Value',\n        value: 'value'\n      }\n    ],\n    ...options\n  };\n};\n\nTaglist.type = type;\nTaglist.label = 'Taglist';\nTaglist.keyed = true;\nTaglist.emptyValue = [];\nTaglist.sanitizeValue = sanitizeMultiSelectValue;","import Markup from 'preact-markup';\n\nimport {\n  formFieldClasses,\n  safeMarkdown\n} from '../Util';\n\nconst type = 'text';\n\n\nexport default function Text(props) {\n  const { field } = props;\n\n  const { text = '' } = field;\n\n  return <div class={ formFieldClasses(type) }>\n    <Markup markup={ safeMarkdown(text) } trim={ false } />\n  </div>;\n}\n\nText.create = function(options = {}) {\n  return {\n    text: '# Text',\n    ...options\n  };\n};\n\nText.type = type;\nText.keyed = false;","import { isArray, isObject } from 'min-dash';\nimport { useContext } from 'preact/hooks';\n\nimport { FormContext } from '../../context';\n\nimport Description from '../Description';\nimport Errors from '../Errors';\nimport Label from '../Label';\n\nimport {\n  formFieldClasses,\n  prefixId\n} from '../Util';\n\nconst type = 'textfield';\n\n\nexport default function Textfield(props) {\n  const {\n    disabled,\n    errors = [],\n    field,\n    value = ''\n  } = props;\n\n  const {\n    description,\n    id,\n    label,\n    validate = {}\n  } = field;\n\n  const { required } = validate;\n\n  const onChange = ({ target }) => {\n    props.onChange({\n      field,\n      value: target.value\n    });\n  };\n\n  const { formId } = useContext(FormContext);\n\n  return <div class={ formFieldClasses(type, errors) }>\n    <Label\n      id={ prefixId(id, formId) }\n      label={ label }\n      required={ required } />\n    <input\n      class=\"fjs-input\"\n      disabled={ disabled }\n      id={ prefixId(id, formId) }\n      onInput={ onChange }\n      type=\"text\"\n      value={ value } />\n    <Description description={ description } />\n    <Errors errors={ errors } />\n  </div>;\n}\n\nTextfield.create = function(options = {}) {\n  return {\n    ...options\n  };\n};\n\nTextfield.type = type;\nTextfield.label = 'Text Field';\nTextfield.keyed = true;\nTextfield.emptyValue = '';\nTextfield.sanitizeValue = ({ value }) => (isArray(value) || isObject(value)) ? null : String(value);","import Button from './form-fields/Button';\nimport Checkbox from './form-fields/Checkbox';\nimport Checklist from './form-fields/Checklist';\nimport Default from './form-fields/Default';\nimport FormComponent from './FormComponent';\nimport Number from './form-fields/Number';\nimport Radio from './form-fields/Radio';\nimport Select from './form-fields/Select';\nimport Taglist from './form-fields/Taglist';\nimport Text from './form-fields/Text';\nimport Textfield from './form-fields/Textfield';\n\nexport {\n  Button,\n  Checkbox,\n  Checklist,\n  Default,\n  FormComponent,\n  Number,\n  Radio,\n  Select,\n  Taglist,\n  Text,\n  Textfield\n};\n\nexport const formFields = [\n  Button,\n  Checkbox,\n  Checklist,\n  Default,\n  Number,\n  Radio,\n  Select,\n  Taglist,\n  Text,\n  Textfield\n];","import { formFields } from './components';\n\nexport default class FormFields {\n  constructor() {\n    this._formFields = {};\n\n    formFields.forEach((formField) => {\n      const { type } = formField;\n\n      this.register(type, formField);\n    });\n  }\n\n  register(type, formField) {\n    this._formFields[ type ] = formField;\n  }\n\n  get(type) {\n    return this._formFields[ type ];\n  }\n}","import { render } from 'preact';\nimport { useCallback, useState } from 'preact/hooks';\n\nimport FormComponent from './components/FormComponent';\n\nimport { FormContext } from './context';\n\n/**\n * @typedef { { container } } Config\n * @typedef { import('didi').Injector } Injector\n * @typedef { import('../core/EventBus').default } EventBus\n * @typedef { import('../Form').default } Form\n */\n\n/**\n * @param {Config} config\n * @param {EventBus} eventBus\n * @param {Form} form\n * @param {Injector} injector\n */\nexport default function Renderer(config, eventBus, form, injector) {\n\n  const App = () => {\n    const [ state, setState ] = useState(form._getState());\n\n    const formContext = {\n      getService(type, strict = true) {\n        return injector.get(type, strict);\n      },\n      formId: form._id\n    };\n\n    eventBus.on('changed', (newState) => {\n      setState(newState);\n    });\n\n    const onChange = useCallback((update) => form._update(update), [ form ]);\n\n    const { properties } = state;\n\n    const { readOnly } = properties;\n\n    const onSubmit = useCallback(() => {\n      if (!readOnly) {\n        form.submit();\n      }\n    }, [ form, readOnly ]);\n\n    const onReset = useCallback(() => form.reset(), [ form ]);\n\n    const { schema } = state;\n\n    if (!schema) {\n      return null;\n    }\n\n    return (\n      <FormContext.Provider value={ formContext }>\n        <FormComponent\n          onChange={ onChange }\n          onSubmit={ onSubmit }\n          onReset={ onReset } />\n      </FormContext.Provider>\n    );\n  };\n\n  const { container } = config;\n\n  eventBus.on('form.init', () => {\n    render(<App />, container);\n  });\n\n  eventBus.on('form.destroy', () => {\n    render(null, container);\n  });\n}\n\nRenderer.$inject = [ 'config.renderer', 'eventBus', 'form', 'injector' ];","import FormFields from './FormFields';\nimport Renderer from './Renderer';\n\nexport { FormFields };\n\nexport * from './components';\nexport * from './context';\n\nexport default {\n  __init__: [ 'formFields', 'renderer' ],\n  formFields: [ 'type', FormFields ],\n  renderer: [ 'type', Renderer ]\n};","import EventBus from './EventBus';\nimport Validator from './Validator';\nimport FormFieldRegistry from './FormFieldRegistry';\n\nimport importModule from '../import';\nimport renderModule from '../render';\n\nexport { FormFieldRegistry };\n\nexport default {\n  __depends__: [ importModule, renderModule ],\n  eventBus: [ 'type', EventBus ],\n  formFieldRegistry: [ 'type', FormFieldRegistry ],\n  validator: [ 'type', Validator ]\n};","import Ids from 'ids';\r\nimport { get, isString, set } from 'min-dash';\r\n\r\nimport core from './core';\r\n\r\nimport { clone, createFormContainer, createInjector, pathStringify } from './util';\r\n\r\n/**\r\n * @typedef { import('./types').Injector } Injector\r\n * @typedef { import('./types').Data } Data\r\n * @typedef { import('./types').Errors } Errors\r\n * @typedef { import('./types').Schema } Schema\r\n * @typedef { import('./types').FormProperties } FormProperties\r\n * @typedef { import('./types').FormProperty } FormProperty\r\n * @typedef { import('./types').FormEvent } FormEvent\r\n * @typedef { import('./types').FormOptions } FormOptions\r\n *\r\n * @typedef { {\r\n *   data: Data,\r\n *   initialData: Data,\r\n *   errors: Errors,\r\n *   properties: FormProperties,\r\n *   schema: Schema\r\n * } } State\r\n *\r\n * @typedef { (type:FormEvent, priority:number, handler:Function) => void } OnEventWithPriority\r\n * @typedef { (type:FormEvent, handler:Function) => void } OnEventWithOutPriority\r\n * @typedef { OnEventWithPriority & OnEventWithOutPriority } OnEventType\r\n */\r\n\r\nconst ids = new Ids([ 32, 36, 1 ]);\r\n\r\n/**\r\n * The form.\r\n */\r\nexport default class Form {\r\n\r\n  /**\r\n   * @constructor\r\n   * @param {FormOptions} options\r\n   */\r\n  constructor(options = {}) {\r\n\r\n    /**\r\n     * @public\r\n     * @type {OnEventType}\r\n     */\r\n    this.on = this._onEvent;\r\n\r\n    /**\r\n     * @public\r\n     * @type {String}\r\n     */\r\n    this._id = ids.next();\r\n\r\n    /**\r\n     * @private\r\n     * @type {Element}\r\n     */\r\n    this._container = createFormContainer();\r\n\r\n    const {\r\n      container,\r\n      injector = this._createInjector(options, this._container),\r\n      properties = {}\r\n    } = options;\r\n\r\n    /**\r\n     * @private\r\n     * @type {State}\r\n     */\r\n    this._state = {\r\n      initialData: null,\r\n      data: null,\r\n      properties,\r\n      errors: {},\r\n      schema: null\r\n    };\r\n\r\n    this.get = injector.get;\r\n\r\n    this.invoke = injector.invoke;\r\n\r\n    this.get('eventBus').fire('form.init');\r\n\r\n    if (container) {\r\n      this.attachTo(container);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n\r\n    // clear form services\r\n    this._emit('diagram.clear');\r\n\r\n    // clear diagram services (e.g. EventBus)\r\n    this._emit('form.clear');\r\n  }\r\n\r\n  /**\r\n   * Destroy the form, removing it from DOM,\r\n   * if attached.\r\n   */\r\n  destroy() {\r\n\r\n    // destroy form services\r\n    this.get('eventBus').fire('form.destroy');\r\n\r\n    // destroy diagram services (e.g. EventBus)\r\n    this.get('eventBus').fire('diagram.destroy');\r\n\r\n    this._detach(false);\r\n  }\r\n\r\n  /**\r\n   * Open a form schema with the given initial data.\r\n   *\r\n   * @param {Schema} schema\r\n   * @param {Data} [data]\r\n   *\r\n   * @return Promise<{ warnings: Array<any> }>\r\n   */\r\n  importSchema(schema, data = {}) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        this.clear();\r\n\r\n        const {\r\n          schema: importedSchema,\r\n          data: importedData,\r\n          warnings\r\n        } = this.get('importer').importSchema(schema, data);\r\n\r\n        this._setState({\r\n          data: importedData,\r\n          errors: {},\r\n          schema: importedSchema,\r\n          initialData: clone(importedData)\r\n        });\r\n\r\n        this._emit('import.done', { warnings });\r\n\r\n        return resolve({ warnings });\r\n      } catch (error) {\r\n        this._emit('import.done', {\r\n          error,\r\n          warnings: error.warnings || []\r\n        });\r\n\r\n        return reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Submit the form, triggering all field validations.\r\n   *\r\n   * @returns { { data: Data, errors: Errors } }\r\n   */\r\n  submit() {\r\n\r\n    const {\r\n      properties\r\n    } = this._getState();\r\n\r\n    if (properties.readOnly) {\r\n      throw new Error('form is read-only');\r\n    }\r\n\r\n    const formFieldRegistry = this.get('formFieldRegistry');\r\n\r\n    const data = formFieldRegistry.getAll().reduce((data, field) => {\r\n      const {\r\n        disabled,\r\n        _path\r\n      } = field;\r\n\r\n      // do not submit disabled form fields\r\n      if (disabled || !_path) {\r\n        return data;\r\n      }\r\n\r\n      const value = get(this._getState().data, _path);\r\n\r\n      return {\r\n        ...data,\r\n        [ _path[ 0 ] ]: value\r\n      };\r\n    }, {});\r\n\r\n    const errors = this.validate();\r\n\r\n    this._emit('submit', {\r\n      data,\r\n      errors\r\n    });\r\n\r\n    return {\r\n      data,\r\n      errors\r\n    };\r\n  }\r\n\r\n  reset() {\r\n    this._emit('reset');\r\n\r\n    this._setState({\r\n      data: clone(this._state.initialData),\r\n      errors: {}\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @returns {Errors}\r\n   */\r\n  validate() {\r\n    const formFieldRegistry = this.get('formFieldRegistry'),\r\n          validator = this.get('validator');\r\n\r\n    const { data } = this._getState();\r\n\r\n    const errors = formFieldRegistry.getAll().reduce((errors, field) => {\r\n      const {\r\n        disabled,\r\n        _path\r\n      } = field;\r\n\r\n      if (disabled) {\r\n        return errors;\r\n      }\r\n\r\n      const value = get(data, _path);\r\n\r\n      const fieldErrors = validator.validateField(field, value);\r\n\r\n      return set(errors, [ pathStringify(_path) ], fieldErrors.length ? fieldErrors : undefined);\r\n    }, /** @type {Errors} */ ({}));\r\n\r\n    this._setState({ errors });\r\n\r\n    return errors;\r\n  }\r\n\r\n  /**\r\n   * @param {Element|string} parentNode\r\n   */\r\n  attachTo(parentNode) {\r\n    if (!parentNode) {\r\n      throw new Error('parentNode required');\r\n    }\r\n\r\n    this.detach();\r\n\r\n    if (isString(parentNode)) {\r\n      parentNode = document.querySelector(parentNode);\r\n    }\r\n\r\n    const container = this._container;\r\n\r\n    parentNode.appendChild(container);\r\n\r\n    this._emit('attach');\r\n  }\r\n\r\n  detach() {\r\n    this._detach();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   *\r\n   * @param {boolean} [emit]\r\n   */\r\n  _detach(emit = true) {\r\n    const container = this._container,\r\n          parentNode = container.parentNode;\r\n\r\n    if (!parentNode) {\r\n      return;\r\n    }\r\n\r\n    if (emit) {\r\n      this._emit('detach');\r\n    }\r\n\r\n    parentNode.removeChild(container);\r\n  }\r\n\r\n  /**\r\n   * @param {FormProperty} property\r\n   * @param {any} value\r\n   */\r\n  setProperty(property, value) {\r\n    const properties = set(this._getState().properties, [ property ], value);\r\n\r\n    this._setState({ properties });\r\n  }\r\n\r\n  /**\r\n   * @param {FormEvent} type\r\n   * @param {Function} handler\r\n   */\r\n  off(type, handler) {\r\n    this.get('eventBus').off(type, handler);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   *\r\n   * @param {FormOptions} options\r\n   * @param {Element} container\r\n   *\r\n   * @returns {Injector}\r\n   */\r\n  _createInjector(options, container) {\r\n    const {\r\n      additionalModules = [],\r\n      modules = []\r\n    } = options;\r\n\r\n    const config = {\r\n      renderer: {\r\n        container\r\n      }\r\n    };\r\n\r\n    return createInjector([\r\n      { config: [ 'value', config ] },\r\n      { form: [ 'value', this ] },\r\n      core,\r\n      ...modules,\r\n      ...additionalModules\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  _emit(type, data) {\r\n    this.get('eventBus').fire(type, data);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   *\r\n   * @param { { add?: boolean, field: any, remove?: number, value?: any } } update\r\n   */\r\n  _update(update) {\r\n    const {\r\n      field,\r\n      value\r\n    } = update;\r\n\r\n    const { _path } = field;\r\n\r\n    let {\r\n      data,\r\n      errors\r\n    } = this._getState();\r\n\r\n    const validator = this.get('validator');\r\n\r\n    const fieldErrors = validator.validateField(field, value);\r\n\r\n    set(data, _path, value);\r\n\r\n    set(errors, [ pathStringify(_path) ], fieldErrors.length ? fieldErrors : undefined);\r\n\r\n    this._setState({\r\n      data: clone(data),\r\n      errors: clone(errors)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  _getState() {\r\n    return this._state;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  _setState(state) {\r\n    this._state = {\r\n      ...this._state,\r\n      ...state\r\n    };\r\n\r\n    this._emit('changed', this._getState());\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  _onEvent(type, priority, handler) {\r\n    this.get('eventBus').on(type, priority, handler);\r\n  }\r\n\r\n}","import Form from './Form';\r\n\r\nexport { FormFieldRegistry } from './core';\r\nexport * from './render';\r\nexport * from './util';\r\n\r\nconst schemaVersion = 5;\r\n\r\nexport {\r\n  Form,\r\n  schemaVersion\r\n};\r\n\r\n/**\r\n * @typedef { import('./types').CreateFormOptions } CreateFormOptions\r\n */\r\n\r\n/**\r\n * Create a form.\r\n *\r\n * @param {CreateFormOptions} options\r\n *\r\n * @return {Promise<Form>}\r\n */\r\nexport function createForm(options) {\r\n  const {\r\n    data,\r\n    schema,\r\n    ...rest\r\n  } = options;\r\n\r\n  const form = new Form(rest);\r\n\r\n  return form.importSchema(schema, data).then(function() {\r\n    return form;\r\n  });\r\n}"],"names":["FN_REF","DEFAULT_PRIORITY","slice","Array","prototype","EventBus","_listeners","on","_destroy","events","priority","callback","that","isArray","isFunction","isNumber","Error","actualCallback","bind","self","forEach","e","_addListener","next","once","event","wrappedCallback","__isTomb","result","apply","arguments","off","_removeListener","createEvent","data","InternalEvent","init","fire","type","firstListener","returnValue","args","call","originalType","_invokeListeners","undefined","defaultPrevented","handleError","error","listener","cancelBubble","_invokeListener","invokeFunction","stopPropagation","preventDefault","console","newListener","_getListeners","previousListener","_setListeners","name","nextListener","listenerCallback","assign","fn","Validator","validateField","field","value","validate","errors","pattern","RegExp","test","required","isNil","min","max","trim","length","minLength","maxLength","$inject","FormFieldRegistry","constructor","eventBus","_eventBus","_formFields","clear","_ids","Ids","_keys","add","formField","id","remove","get","getAll","Object","values","createInjector","bootstrapModules","injector","Injector","createFormContainer","prefix","container","document","createElement","classList","findErrors","path","pathStringify","isRequired","pathParse","split","map","key","isNaN","parseInt","pathsEqual","a","b","every","index","join","indices","generateIndexForType","generateIdForType","clone","replacer","JSON","parse","stringify","getSchemaVariables","schema","components","reduce","variables","component","valuesKey","includes","Importer","formFieldRegistry","formFields","_formFieldRegistry","importSchema","warnings","importedSchema","importFormField","importedData","importData","err","parentId","_parent","assigned","claim","_path","importFormFields","defaultValue","fieldImplementation","valueData","isUndefined","sanitizeValue","initialFieldValue","emptyValue","importer","NODE_TYPE_TEXT","NODE_TYPE_ELEMENT","ALLOWED_NODES","ALLOWED_ATTRIBUTES","ALLOWED_URI_PATTERN","ATTR_WHITESPACE_PATTERN","FORM_ELEMENT","sanitizeHTML","html","doc","DOMParser","parseFromString","normalize","element","body","firstChild","sanitizeNode","XMLSerializer","serializeToString","node","nodeType","lcTag","tagName","toLowerCase","attributes","i","attribute","lcName","removeAttribute","valid","isValidAttribute","setAttribute","getAttribute","childNodes","replace","formFieldClasses","classes","push","prefixId","formId","markdownToHTML","markdown","htmls","line","snarkdown","safeMarkdown","sanitizeSingleSelectValue","options","validValues","v","sanitizeMultiSelectValue","filter","Button","props","disabled","action","_jsx","label","create","keyed","FormRenderContext","createContext","Empty","Children","children","Element","getService","strict","FormContext","Description","description","Errors","Label","_jsxs","Checkbox","onChange","target","checked","useContext","LOAD_STATES","LOADING","LOADED","ERROR","staticValues","valuesGetter","setValuesGetter","useState","state","initialData","useService","_getState","useEffect","keyedValues","getErrorState","buildLoadedState","Checklist","toggleCheckbox","newValue","x","loadState","useValuesAsync","noop","FormField","form","properties","FormFieldComponent","fieldErrors","readOnly","Default","childField","_createElement","Logo","Lightbox","open","onBackdropClick","Link","onClick","PoweredBy","setOpen","toggleOpen","createPortal","FormComponent","onSubmit","onReset","handleSubmit","handleReset","Number","parsedValue","Radio","option","Select","useOptionsAsync","useKeyDownAction","targetKey","listenerElement","window","downHandler","addEventListener","removeEventListener","DEFAULT_LABEL_GETTER","NOOP","DropdownList","keyEventsListener","getLabel","onValueSelected","height","emptyListMessage","mouseControl","setMouseControl","focusedValueIndex","setFocusedValueIndex","dropdownContainer","useRef","mouseScreenPos","focusedItem","useMemo","changeFocusedValueIndex","useCallback","delta","Math","individualEntries","current","scrollIntoView","block","inline","mouseMove","userMoved","screenX","y","screenY","maxHeight","Taglist","setFilter","filteredOptions","setFilteredOptions","isDropdownExpanded","setIsDropdownExpanded","hasOptionsLeft","setHasOptionsLeft","isEscapeClosed","setIsEscapeClose","searchbarRef","valueToOptionMap","o","onFilterChange","selectValue","at","deselectValue","onInputKeyDown","classNames","Text","text","Textfield","isObject","String","FormFields","register","Renderer","config","App","setState","formContext","_id","newState","update","_update","submit","reset","render","__init__","renderer","__depends__","importModule","renderModule","validator","ids","Form","_onEvent","_container","_createInjector","_state","invoke","attachTo","_emit","destroy","_detach","Promise","resolve","reject","_setState","set","parentNode","detach","isString","querySelector","appendChild","emit","removeChild","setProperty","property","handler","additionalModules","modules","core","schemaVersion","createForm","rest","then"],"mappings":";;;;;;;;;;;AAQA,IAAIA,MAAM,GAAG,MAAb;AAEA,IAAIC,gBAAgB,GAAG,IAAvB;AAEA,IAAIC,KAAK,GAAGC,KAAK,CAACC,SAAN,CAAgBF,KAA5B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACe,SAASG,QAAT,GAAoB;EACjC,KAAKC,UAAL,GAAkB,EAAlB,CADiC;;;EAKjC,KAAKC,EAAL,CAAQ,iBAAR,EAA2B,CAA3B,EAA8B,KAAKC,QAAnC,EAA6C,IAA7C;AACD;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAH,QAAQ,CAACD,SAAT,CAAmBG,EAAnB,GAAwB,UAASE,MAAT,EAAiBC,QAAjB,EAA2BC,QAA3B,EAAqCC,IAArC,EAA2C;EAEjEH,MAAM,GAAGI,OAAO,CAACJ,MAAD,CAAP,GAAkBA,MAAlB,GAA2B,CAAEA,MAAF,CAApC;;EAEA,IAAIK,UAAU,CAACJ,QAAD,CAAd,EAA0B;IACxBE,IAAI,GAAGD,QAAP;IACAA,QAAQ,GAAGD,QAAX;IACAA,QAAQ,GAAGT,gBAAX;;;EAGF,IAAI,CAACc,QAAQ,CAACL,QAAD,CAAb,EAAyB;IACvB,MAAM,IAAIM,KAAJ,CAAU,2BAAV,CAAN;;;EAGF,IAAIC,cAAc,GAAGN,QAArB;;EAEA,IAAIC,IAAJ,EAAU;IACRK,cAAc,GAAGC,IAAI,CAACP,QAAD,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"}