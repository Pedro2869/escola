{"version":3,"file":"index.es.js","sources":["../src/components/Modal.js","../src/components/EmbedModal.js","../src/components/JSONEditor.js","../src/components/Section.js","../src/components/PlaygroundRoot.js","../src/Playground.js"],"sourcesContent":["import { useEffect } from 'preact/hooks';\n\nexport function Modal(props) {\n\n  useEffect(() => {\n    function handleKey(event) {\n\n      if (event.key === 'Escape') {\n        event.stopPropagation();\n\n        props.onClose();\n      }\n    }\n\n    document.addEventListener('keydown', handleKey);\n\n    return () => {\n      document.removeEventListener('keydown', handleKey);\n    };\n  });\n\n  return (\n    <div class=\"fjs-pgl-modal\">\n      <div class=\"fjs-pgl-modal-backdrop\" onClick={ props.onClose }></div>\n      <div class=\"fjs-pgl-modal-content\">\n        <h1 class=\"fjs-pgl-modal-header\">{ props.name }</h1>\n        <div class=\"fjs-pgl-modal-body\">\n          { props.children }\n        </div>\n        <div class=\"fjs-pgl-modal-footer\">\n          <button class=\"fjs-pgl-button fjs-pgl-button-default\" onClick={ props.onClose }>Close</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useRef } from 'preact/hooks';\n\nimport { Modal } from './Modal';\n\n\nexport function EmbedModal(props) {\n\n  const schema = serializeValue(props.schema);\n  const data = serializeValue(props.data || {});\n\n  const fieldRef = useRef();\n\n  const snippet = `<!-- styles needed for rendering -->\n<link rel=\"stylesheet\" href=\"https://unpkg.com/@bpmn-io/form-js@0.2.4/dist/assets/form-js.css\">\n\n<!-- container to render the form into -->\n<div class=\"fjs-pgl-form-container\"></div>\n\n<!-- scripts needed for embedding -->\n<script src=\"https://unpkg.com/@bpmn-io/form-js@0.2.4/dist/form-viewer.umd.js\"></script>\n\n<!-- actual script to instantiate the form and load form schema + data -->\n<script>\n  const data = JSON.parse(${data});\n  const schema = JSON.parse(${schema});\n\n  const form = new FormViewer.Form({\n    container: document.querySelector(\".fjs-pgl-form-container\")\n  });\n\n  form.on(\"submit\", (event) => {\n    console.log(event.data, event.errors);\n  });\n\n  form.importSchema(schema, data).catch(err => {\n    console.error(\"Failed to render form\", err);\n  });\n</script>\n  `.trim();\n\n  useEffect(() => {\n    fieldRef.current.select();\n  });\n\n  return (\n    <Modal name=\"Embed form\" onClose={ props.onClose }>\n      <p>Use the following HTML snippet to embed your form with <a href=\"https://github.com/bpmn-io/form-js\">form-js</a>:</p>\n\n      <textarea spellCheck=\"false\" ref={ fieldRef }>{snippet}</textarea>\n    </Modal>\n  );\n}\n\n\n// helpers ///////////\n\nfunction serializeValue(obj) {\n  return JSON.stringify(JSON.stringify(obj)).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}","import mitt from 'mitt';\n\nimport { basicSetup } from 'codemirror';\nimport { EditorView } from '@codemirror/view';\nimport { EditorState, Compartment } from '@codemirror/state';\nimport { json } from '@codemirror/lang-json';\n\n\nexport function JSONEditor(options = {}) {\n\n  const emitter = mitt();\n\n  const {\n    readonly = false\n  } = options;\n\n  let language = new Compartment().of(json());\n  let tabSize = new Compartment().of(EditorState.tabSize.of(2));\n\n  function createState(doc, extensions = []) {\n    return EditorState.create({\n      doc,\n      extensions: [\n        basicSetup,\n        language,\n        tabSize,\n        ...extensions\n      ]\n    });\n  }\n\n  function createView(readonly) {\n\n    const updateListener = EditorView.updateListener.of(update => {\n      if (update.docChanged) {\n        emitter.emit('changed', {\n          value: update.view.state.doc.toString()\n        });\n      }\n    });\n\n    const editable = EditorView.editable.of(!readonly);\n\n    const view = new EditorView({\n      state: createState('', [ updateListener, editable ])\n    });\n\n    view.setValue = function(value) {\n      this.setState(createState(value, [ updateListener, editable ]));\n    };\n\n    return view;\n  }\n\n  const view = createView(readonly);\n\n  this.setValue = function(value) {\n    view.setValue(value);\n  };\n\n  this.getValue = function() {\n    return view.state.doc.toString();\n  };\n\n  this.on = emitter.on;\n  this.off = emitter.off;\n\n  this.attachTo = function(container) {\n    container.appendChild(view.dom);\n  };\n\n  this.destroy = function() {\n    if (view.dom.parentNode) {\n      view.dom.parentNode.removeChild(view.dom);\n    }\n\n    view.destroy();\n  };\n}\n","export function Section(props) {\n\n  const elements =\n    Array.isArray(props.children)\n      ? props.children :\n      [ props.children ];\n\n  const {\n    headerItems,\n    children\n  } = elements.reduce((_, child) => {\n    const bucket =\n      child.type === Section.HeaderItem\n        ? _.headerItems\n        : _.children;\n\n    bucket.push(child);\n\n    return _;\n  }, { headerItems: [], children: [] });\n\n  return (\n    <div class=\"fjs-pgl-section\">\n      <h1 class=\"header\">{ props.name } { headerItems.length ? <span class=\"header-items\">{ headerItems }</span> : null }</h1>\n      <div class=\"body\">\n        { children }\n      </div>\n    </div>\n  );\n}\n\nSection.HeaderItem = function(props) {\n  return props.children;\n};","import { useRef, useEffect, useState, useCallback } from 'preact/hooks';\n\nimport download from 'downloadjs';\n\nimport classNames from 'classnames';\n\nimport {\n  Form\n} from '@bpmn-io/form-js-viewer';\n\nimport {\n  FormEditor\n} from '@bpmn-io/form-js-editor';\n\nimport { EmbedModal } from './EmbedModal';\nimport { JSONEditor } from './JSONEditor';\nimport { Section } from './Section';\n\n\nimport './FileDrop.css';\nimport './PlaygroundRoot.css';\n\n\nexport function PlaygroundRoot(props) {\n\n  const {\n    actions: actionsConfig = {},\n    editor: editorConfig = {},\n    emit,\n    exporter: exporterConfig = {}\n  } = props;\n\n  const {\n    display: displayActions = true\n  } = actionsConfig;\n\n  const {\n    inlinePropertiesPanel = true\n  } = editorConfig;\n\n  const paletteContainerRef = useRef();\n  const editorContainerRef = useRef();\n  const formContainerRef = useRef();\n  const dataContainerRef = useRef();\n  const resultContainerRef = useRef();\n  const propertiesPanelContainerRef = useRef();\n\n  const paletteRef = useRef();\n  const formEditorRef = useRef();\n  const formRef = useRef();\n  const dataEditorRef = useRef();\n  const resultViewRef = useRef();\n  const propertiesPanelRef = useRef();\n\n  const [ showEmbed, setShowEmbed ] = useState(false);\n\n  const [ initialData ] = useState(props.data || {});\n  const [ initialSchema, setInitialSchema ] = useState(props.schema);\n\n  const [ data, setData ] = useState(props.data || {});\n  const [ schema, setSchema ] = useState(props.schema);\n\n  const [ resultData, setResultData ] = useState(props.data || {});\n\n  // pipe to playground API\n  useEffect(() => {\n    props.onInit({\n      attachDataContainer: (node) => dataEditorRef.current.attachTo(node),\n      attachEditorContainer: (node) => formEditorRef.current.attachTo(node),\n      attachFormContainer: (node) => formRef.current.attachTo(node),\n      attachPaletteContainer: (node) => paletteRef.current.attachTo(node),\n      attachPropertiesPanelContainer: (node) => propertiesPanelRef.current.attachTo(node),\n      attachResultContainer: (node) => resultViewRef.current.attachTo(node),\n      get: (name, strict) => formEditorRef.current.get(name, strict),\n      getEditor: () => formEditorRef.current,\n      getSchema: () => formEditorRef.current.getSchema(),\n      setSchema: setInitialSchema,\n      saveSchema: () => formEditorRef.current.saveSchema()\n    });\n  });\n\n  useEffect(() => {\n    setInitialSchema(props.schema || {});\n  }, [ props.schema ]);\n\n  useEffect(() => {\n    const dataEditor = dataEditorRef.current = new JSONEditor({\n      value: toJSON(data)\n    });\n\n    const resultView = resultViewRef.current = new JSONEditor({\n      readonly: true,\n      value: toJSON(resultData)\n    });\n\n    const form = formRef.current = new Form();\n    const formEditor = formEditorRef.current = new FormEditor({\n      renderer: {\n        compact: true\n      },\n      palette: {\n        parent: paletteContainerRef.current\n      },\n      propertiesPanel: {\n        parent: !inlinePropertiesPanel && propertiesPanelContainerRef.current\n      },\n      exporter: exporterConfig\n    });\n\n    paletteRef.current = formEditor.get('palette');\n    propertiesPanelRef.current = formEditor.get('propertiesPanel');\n\n    formEditor.on('changed', () => {\n      setSchema(formEditor.getSchema());\n    });\n\n    formEditor.on('formEditor.rendered', () => {\n\n      // notifiy interested parties after render\n      emit('formPlayground.rendered');\n    });\n\n    form.on('changed', event => {\n      setResultData(event.data);\n    });\n\n    dataEditor.on('changed', event => {\n      try {\n        setData(JSON.parse(event.value));\n      } catch (err) {\n\n        // TODO(nikku): indicate JSON parse error\n      }\n    });\n\n    const formContainer = formContainerRef.current;\n    const editorContainer = editorContainerRef.current;\n    const dataContainer = dataContainerRef.current;\n    const resultContainer = resultContainerRef.current;\n\n    dataEditor.attachTo(dataContainer);\n    resultView.attachTo(resultContainer);\n    form.attachTo(formContainer);\n    formEditor.attachTo(editorContainer);\n\n    return () => {\n      dataEditor.destroy();\n      resultView.destroy();\n      form.destroy();\n      formEditor.destroy();\n    };\n  }, []);\n\n  useEffect(() => {\n    dataEditorRef.current.setValue(toJSON(initialData));\n  }, [ initialData ]);\n\n  useEffect(() => {\n    initialSchema && formEditorRef.current.importSchema(initialSchema);\n  }, [ initialSchema ]);\n\n  useEffect(() => {\n    schema && formRef.current.importSchema(schema, data);\n  }, [ schema, data ]);\n\n  useEffect(() => {\n    resultViewRef.current.setValue(toJSON(resultData));\n  }, [ resultData ]);\n\n  useEffect(() => {\n    props.onStateChanged({\n      schema,\n      data\n    });\n  }, [ schema, data ]);\n\n  const handleDownload = useCallback(() => {\n\n    download(JSON.stringify(schema, null, '  '), 'form.json', 'text/json');\n  }, [ schema ]);\n\n  const hideEmbedModal = useCallback(() => {\n    setShowEmbed(false);\n  }, []);\n\n  const showEmbedModal = useCallback(() => {\n    setShowEmbed(true);\n  }, []);\n\n  return (\n    <div class={ classNames(\n      'fjs-container',\n      'fjs-pgl-root',\n      { 'fjs-pgl-inline-editor-panel': inlinePropertiesPanel }) }>\n      <div class=\"fjs-pgl-modals\">\n        { showEmbed ? <EmbedModal schema={ schema } data={ data } onClose={ hideEmbedModal } /> : null }\n      </div>\n      <div class=\"fjs-pgl-palette-container\" ref={ paletteContainerRef } />\n      <div class=\"fjs-pgl-main\">\n\n        <Section name=\"Form Definition\">\n\n          {\n            displayActions && <Section.HeaderItem>\n              <button\n                class=\"fjs-pgl-button\"\n                title=\"Download form definition\"\n                onClick={ handleDownload }\n              >Download</button>\n            </Section.HeaderItem>\n          }\n\n          {\n            displayActions && <Section.HeaderItem>\n              <button\n                class=\"fjs-pgl-button\"\n                onClick={ showEmbedModal }\n              >Embed</button>\n            </Section.HeaderItem>\n          }\n\n          <div ref={ editorContainerRef } class=\"fjs-pgl-form-container\"></div>\n        </Section>\n        <Section name=\"Form Preview\">\n          <div ref={ formContainerRef } class=\"fjs-pgl-form-container\"></div>\n        </Section>\n        <Section name=\"Form Data (Input)\">\n          <div ref={ dataContainerRef } class=\"fjs-pgl-text-container\"></div>\n        </Section>\n        <Section name=\"Form Data (Submit)\">\n          <div ref={ resultContainerRef } class=\"fjs-pgl-text-container\"></div>\n        </Section>\n      </div>\n      <div class=\"fjs-pgl-properties-container\" ref={ propertiesPanelContainerRef } />\n    </div>\n  );\n}\n\n\n// helpers ///////////////\n\nfunction toJSON(obj) {\n  return JSON.stringify(obj, null, '  ');\n}","import { render } from 'preact';\n\nimport fileDrop from 'file-drops';\n\nimport mitt from 'mitt';\n\nimport { PlaygroundRoot } from './components/PlaygroundRoot';\n\n/**\n * @typedef { {\n *  actions?: { display: Boolean }\n *  container?: Element\n *  data: any\n *  editor?: { inlinePropertiesPanel: Boolean }\n *  exporter?: { name: String, version: String }\n *  schema: any\n * } } FormPlaygroundOptions\n */\n\n/**\n * @param {FormPlaygroundOptions} options\n */\nexport default function Playground(options) {\n\n  const {\n    container: parent,\n    schema,\n    data,\n    ...rest\n  } = options;\n\n  const emitter = mitt();\n\n  let state = { data, schema };\n  let ref;\n\n  const container = document.createElement('div');\n\n  container.classList.add('fjs-pgl-parent');\n\n  if (parent) {\n    parent.appendChild(container);\n  }\n\n  const handleDrop = fileDrop('Drop a form file', function(files) {\n    const file = files[0];\n\n    if (file) {\n      try {\n        ref.setSchema(JSON.parse(file.contents));\n      } catch (err) {\n\n        // TODO(nikku): indicate JSON parse error\n      }\n    }\n  });\n\n  const withRef = function(fn) {\n    return function(...args) {\n      if (!ref) {\n        throw new Error('Playground is not initialized.');\n      }\n\n      return fn(...args);\n    };\n  };\n\n  const onInit = function(_ref) {\n    ref = _ref;\n    emitter.emit('formPlayground.init');\n  };\n\n  container.addEventListener('dragover', handleDrop);\n\n  render(\n    <PlaygroundRoot\n      data={ data }\n      emit={ emitter.emit }\n      onInit={ onInit }\n      onStateChanged={ (_state) => state = _state }\n      schema={ schema }\n      { ...rest }\n    />,\n    container\n  );\n\n  this.on = emitter.on;\n  this.off = emitter.off;\n\n  this.emit = emitter.emit;\n\n  this.on('destroy', function() {\n    render(null, container);\n  });\n\n  this.on('destroy', function() {\n    parent.removeChild(container);\n  });\n\n  this.getState = function() {\n    return state;\n  };\n\n  this.getSchema = withRef(function() {\n    return ref.getSchema();\n  });\n\n  this.setSchema = withRef(function(schema) {\n    return ref.setSchema(schema);\n  });\n\n  this.saveSchema = withRef(function() {\n    return ref.saveSchema();\n  });\n\n  this.get = withRef(function(name, strict) {\n    return ref.get(name, strict);\n  });\n\n  this.getEditor = withRef(function() {\n    return ref.getEditor();\n  });\n\n  this.destroy = function() {\n    this.emit('destroy');\n  };\n\n  this.attachEditorContainer = withRef(function(node) {\n    return ref.attachEditorContainer(node);\n  });\n\n  this.attachPreviewContainer = withRef(function(node) {\n    return ref.attachFormContainer(node);\n  });\n\n  this.attachDataContainer = withRef(function(node) {\n    return ref.attachDataContainer(node);\n  });\n\n  this.attachResultContainer = withRef(function(node) {\n    return ref.attachResultContainer(node);\n  });\n\n  this.attachPaletteContainer = withRef(function(node) {\n    return ref.attachPaletteContainer(node);\n  });\n\n  this.attachPropertiesPanelContainer = withRef(function(node) {\n    return ref.attachPropertiesPanelContainer(node);\n  });\n}"],"names":["Modal","props","useEffect","handleKey","event","key","stopPropagation","onClose","document","addEventListener","removeEventListener","_jsxs","_jsx","name","children","EmbedModal","schema","serializeValue","data","fieldRef","useRef","snippet","trim","current","select","obj","JSON","stringify","replace","JSONEditor","options","emitter","mitt","readonly","language","Compartment","of","json","tabSize","EditorState","createState","doc","extensions","create","basicSetup","createView","updateListener","EditorView","update","docChanged","emit","value","view","state","toString","editable","setValue","setState","getValue","on","off","attachTo","container","appendChild","dom","destroy","parentNode","removeChild","Section","elements","Array","isArray","headerItems","reduce","_","child","bucket","type","HeaderItem","push","length","PlaygroundRoot","actions","actionsConfig","editor","editorConfig","exporter","exporterConfig","display","displayActions","inlinePropertiesPanel","paletteContainerRef","editorContainerRef","formContainerRef","dataContainerRef","resultContainerRef","propertiesPanelContainerRef","paletteRef","formEditorRef","formRef","dataEditorRef","resultViewRef","propertiesPanelRef","showEmbed","setShowEmbed","useState","initialData","initialSchema","setInitialSchema","setData","setSchema","resultData","setResultData","onInit","attachDataContainer","node","attachEditorContainer","attachFormContainer","attachPaletteContainer","attachPropertiesPanelContainer","attachResultContainer","get","strict","getEditor","getSchema","saveSchema","dataEditor","toJSON","resultView","form","Form","formEditor","FormEditor","renderer","compact","palette","parent","propertiesPanel","parse","err","formContainer","editorContainer","dataContainer","resultContainer","importSchema","onStateChanged","handleDownload","useCallback","download","hideEmbedModal","showEmbedModal","classNames","Playground","rest","ref","createElement","classList","add","handleDrop","fileDrop","files","file","contents","withRef","fn","args","Error","_ref","render","_state","getState","attachPreviewContainer"],"mappings":"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"}